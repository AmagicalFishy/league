# Config file for automatic testing at travis-ci.org
sudo: false  # http://docs.travis-ci.com/user/migrating-from-legacy/
language: python
cache: pip
python:
  - 3.4.5
services:
  - docker
install:
  - ./travis-scripts/install.sh
script:
  - if [ "$TRAVIS_BRANCH" = "master" ] && [ -z "$TRAVIS_TAG" ]; then
      $(aws ecr get-login);
    fi
  - ./travis-scripts/build_assets.sh
  - ./travis-scripts/test.sh
  - ./travis-scripts/build_images.sh \
    AWS_ACCESS_KEY=$AWS_ACCESS_KEY \
    AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
    AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION
after_success:
  - ./travis-scripts/deploy.sh \
    AWS_ACCESS_KEY=$AWS_ACCESS_KEY \
    AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
    AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION
provider: releases
on:
  tags: true
